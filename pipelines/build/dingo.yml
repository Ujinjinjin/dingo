# Azure Pipelines yml instructions

trigger:
  branches:
    include:
    - master
    exclude:
    - release/*

pr:
  branches:
    include:
    - master

variables:
  - name: 'buildName'
    value: 'Dingo build'
  - name: 'solution'
    value: 'src/dingo.sln'
  - name: 'buildPlatform'
    value: 'Any CPU'
  - name: 'buildConfiguration'
    value: 'Release'

name: $[variables.buildName]


jobs:
  - job: windows
    pool:
      vmImage: 'windows-latest'
    
    steps:
    - task: NuGetToolInstaller@1
      displayName: 'install nuget'

    - task: NuGetCommand@2
      displayName: 'nuget restore'
      inputs:
        restoreSolution: '$(solution)'

    - task: VSBuild@1
      displayName: 'build project'
      inputs:
        solution: '$(solution)'
        platform: '$(buildPlatform)'
        configuration: '$(buildConfiguration)'

    - task: DotNetCoreCLI@2
      displayName: 'run unit tests'
      inputs:
        command: 'test'
        projects: 'Src/Dingo.UnitTests/Dingo.UnitTests.csproj'
        testRunTitle: 'Unit tests'
        arguments: '-c $(buildConfiguration) --collect "Code coverage"'
    
    - task: PublishCodeCoverageResults@1
      displayName: 'publish code coverage result'
      inputs:
        codeCoverageTool: 'JaCoCo'
        summaryFileLocation: '**/*.coverage'
